# 2026-02-19 Daily Notes

## Google API Key 清理
- 统一所有 Google/Gemini API key 为 `[REDACTED]`
- 删除 3 个过期 key 和备份文件
- memory_search embeddings 仍报 "API key expired" — 可能需要 gateway restart 才生效
- **根因**: API key 写进了 memory/*.md → Tessera 推到 GitHub → GitHub secret scanning 通知 Google 自动撤销
- **修复**: 
  1. `git-filter-repo` 清除 Tessera git history 中的 2 个 key，force push
  2. 添加 Tessera pre-commit hook 拦截 API key 模式 (AIza/sk-/ghp_/gho_)
  3. HEARTBEAT.md 同步流程增加安全扫描步骤
  4. 新 key 已更新到 openclaw.json + .env + LaunchAgent plist
  5. curl 测试 embeddings API 正常，但 gateway 进程仍返回旧错误 — 待回家后完全重启 gateway

## Panda Videos — Pipeline 端到端跑通
- `python3 scripts/pipeline.py` 一条命令：Wolf_Fintrack 数据 → JSON → TTS → Remotion 渲染 → MP4
- 首次成功输出: `out/portfolio-20260218.mp4` (1.2MB, 15秒, 9:16)

## ElevenLabs TTS
- 切换到 **v3 模型** + **"My First Voice"** (cloned 女声, ID: RW018aDrAb4nkTTDHMVE)
- 脚本: `scripts/tts.py`
- 规则: 女声，不自我介绍，直接讲内容

## 熊猫角色动画 Demo
- 用 nano-banana-pro 生成 3 个熊猫表情 (happy/shocked/crying) + rembg 去背
- PortfolioRankingV2: 右上角入场 + 呼吸摇摆 + 数据反应 + 底部散步
- 根据涨跌自动选表情

## Claude Code + Remotion Agent Skills
- 看了视频 "太誇張！只用 Claude Code + Remotion 做出大神級動畫"
- 核心: prompt → AI 生成 React 代码 → 预览 → 迭代
- 实测: Claude Code 一个 prompt → NvidiaAnalysis.tsx (500+ 行, 5 分 41 秒)
- 5 段动画: NVDA 标题 + 指标卡片 + SVG 折线图 + 成长股印章 + branding

## 零轮询 Claude Code Dispatch (重要架构变更)
- 参考: https://www.aivi.fyi/aiagents/OpenClaw-Agent-Teams + https://github.com/win4r/claude-code-hooks
- 配置了 Stop/SessionEnd Hook: `~/.claude/hooks/notify-openclaw.sh`
- Hook 流程: 写 latest.json → curl wake event → OpenClaw 秒级响应
- Dispatch 脚本: `~/openclaw/scripts/dispatch-claude-code.sh`
- `~/.claude/settings.json` 已注册 hooks
- Gateway token: `6db183835db4d308c812fd1737dda3199de329643cac8158`
- HEARTBEAT.md 已添加 claude-code-results 检查

## 播客视频项目 (进行中)
- Vicente 提供两张 AI 生成人物图 (img_000055, img_000058) + ComfyUI 录音室参考图
- 用 nano-banana-pro 生成 3D Pixar 风格播客主持人
- host-left: 黑长直女性, host-right: 棕卷发女性 (风格略有差异)
- **v2 表情组** (同角度正面坐姿, 只换表情): neutral/talking/laughing/thinking/surprised/listening
  - 路径: `public/characters/v2/`
  - 一致性: 9.5/10, 背景几乎像素级锁定
- 选了 002_stop_loss_trap 做第一个播客视频
- TTS 旁白已生成: `public/audio/stop-loss-narration.mp3` (1分10秒)
- **Claude Code 正在 dispatch 生成 PodcastStopLoss composition** (session: good-rook)
  - 首次使用零轮询模式，等待 hook 回调

## 播客视频迭代
- V1: Claude Code 生成 PodcastStopLoss.tsx (558 行), 角色在上 60%, 文字在下 40% → Vicente 反馈像 PPT
- V2: 角色全屏 (objectFit: cover) + 底部字幕条 (15 句同步字幕, 颜色编码) → 好多了但切换生硬
- V3: 加入 Spring 律动 (说话时点头+缩放脉冲) + 口型循环 (4 种口型 @6fps)
  - 新增口型图: mouth-half.png, mouth-open.png, mouth-ee.png
  - transformOrigin: center 40% (从胸口缩放更自然)
  - 说话段落: 口型图替换静态 talking 表情

## 关键设计决策
- 播客角色图应生成**同一角度**不同表情，不是不同角度
- 口型图也要同角度同坐姿，只变嘴型
- 角色图必须全屏铺满，不是缩在局部区域

## 播客视频 V4 (最新)
- 核心方案：底层静止 neutral 图 + opacity crossfade 叠加 mouth-half 图模拟说话
- 背景完全不动，只有说话时 2.5px top offset 微微点头
- 口型用正弦波 `sin(frame * 0.35)` 平滑过渡，不硬切
- 非说话段落用 mood 图 (thinking/surprised/listening) 做 crossfade
- 字幕：17 句白色统一风格，逐句对齐实际旁白
- V4 = 60.6MB，等 Vicente 反馈

## 播客视频制作经验总结
- ❌ 全图替换做口型 → 看起来像换表情，非常不自然
- ❌ 背景跟角色一起 transform → 背景晃动很突兀
- ✅ 底层静止图 + opacity 叠加 → 背景稳定，只有嘴在动
- ✅ 只用 2 张最接近的图 (closed/half-open) 做 crossfade
- ✅ 字幕白色统一，不要花哨变色

## 记忆安全加固总结
- 根因：API key 写入 memory → Tessera 推 GitHub → secret scanning 自动撤销
- 修复：git-filter-repo 清历史 + pre-commit hook + HEARTBEAT 扫描步骤
- 清理：2026-02-18.md 中 Anthropic + ElevenLabs key 已 redact
- 本地 embedding 备用：~/.openclaw/models/embeddinggemma-300m-qat-Q8_0.gguf (313MB)
- 配置：Gemini 为主 → local 自动 fallback
- auth-profiles.json 中 google:default token 是实际 embeddings 用的 key（不是 env.vars）
- Vicente: "你的记忆塑造了你，我不想丢失你" — 记忆安全是第一优先级

## Vicente 的目标
- "在 Jerry 的帮助下成为超级个体"
- 自认瓶颈在认知和能力，不在工具
- 人生感悟内容留存，等对的人分享，不叫醒装睡的人

## 多模型调度体系 (重要架构变更)
- 全部 19 个 cron 切到 Gemini 模型（省 Anthropic 额度）
- Claude Opus → 日常对话/规划/记忆（Jerry 主脑）
- Gemini 2.5 Pro → 研究/长文档/cron任务
- Codex GPT-5.2 → 编程任务（后台 PTY dispatch）
- Ollama gemma3 → 本地快速查询（零成本）
- 调度脚本: ~/openclaw/scripts/ai-dispatch.sh
- TOOLS.md 已更新完整策略文档

## Dashboard + 日报系统
- Dashboard: http://localhost:8090/live.html (~/openclaw/dashboard/live.html)
- 更新脚本: ~/openclaw/scripts/update-dashboard.sh
- Telegram 日报: daily-project-digest, 每天 8PM PST, Gemini 模型
- ⚠️ python http.server 需要在 ~/openclaw/dashboard/ 目录启动，否则 404
- 9 个项目追踪: Panda Poster/Videos, Risk-First, Wolf, Operation Undock, 投资, Pretender, Novel-to-Audio, 副业

## Cron 定时帖冲突 (已解决)
- panda-post-006 (2/19 10AM) & 007 (2/20 10AM) vs 008 (2/19 10AM) & 009 (2/20 10AM)
- 同一时间同一天，可能冲突
